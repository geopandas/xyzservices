name: Compress providers

on:
  pull_request:
    types: [ labeled ]

jobs:
  compress:
    if: ${{ github.event.label.name == 'community_contribution' }}
    runs-on: ubuntu-latest
    timeout-minutes: 30
    strategy:
      matrix:
        environment-file: [ci/update_providers.yaml]

    steps:
    - name: checkout repo
      uses: actions/checkout@v2

    - name: setup micromamba
      uses: mamba-org/provision-with-micromamba@main
      with:
        environment-file: ${{ matrix.environment-file }}
        micromamba-version: 'latest'

    - name: Parse leaflet providers/compress output
      shell: bash -l {0}
      run: |
        make compress

    - name: Commit changes
      uses: EndBug/add-and-commit@v7
      with:
        author_name: Martin Fleischmann
        author_email: martinfleis@users.noreply.github.com
        message: 'Compress JSON [automated]'
        add: 'xyzservices/data/providers.json'